{
  "services": {
    "express_service": {
      "name": "express_service",
      "image": "node:latest",
      "container_name": "express_service",
      "context": ".",
      "dockerfile": "./backend/Dockerfile",
      "domains": [
        "localhost"
      ],
      "ports": [
        "3001:3001"
      ],
      "networks": [
        "qrgen"
      ],
      "restart": "on-failure",
      "locations": [
        "/qr"
      ],
      "volumes": {
        "./backend/logs": "/root/.npm/_logs",
        "./certs": "/etc/letsencrypt"
      }
    },
    "prometheus_init": {
      "name": "prometheus_init",
      "image": "prom/prometheus:v2.51.1",
      "container_name": "prometheus_init",
      "user": "root",
      "entrypoint": "/bin/sh -c 'chown -R 65534:65534 /prometheus/data'",
      "volumes": {
      "./prometheus/data": "/prometheus/data"
      }
    },
    "prometheus": {
      "name": "prometheus",
      "image": "prom/prometheus:v2.51.1",
      "container_name": "prometheus",
      "command": "--config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus/data --web.console.libraries=/etc/prometheus/console_libraries --web.console.templates=/etc/prometheus/consoles",
      "domains": [
        "localhost"
      ],
      "ports": [
        "9090:9090"
      ],
      "networks": [
        "qrgen"
      ],
      "restart": "on-failure",
      "locations": [
        "/prometheus"
      ],
      "volumes": {
        "./prometheus/data": "/prometheus/data",
        "./prometheus/config": "/etc/prometheus",
        "./prometheus/console_libraries": "/etc/prometheus/console_libraries",
        "./prometheus/consoles": "/etc/prometheus/consoles",
        "./prometheus/logs": "/var/log/prometheus"
      },
      "depends_on": [
        "prometheus_init"
      ]
    },
    "grafana": {
      "name": "grafana",
      "image": "grafana/grafana",
      "container_name": "grafana",
      "domains": [
        "localhost"
      ],
      "ports": [
        "3000:3000"
      ],
      "networks": [
        "qrgen"
      ],
      "restart": "on-failure",
      "locations": [
        "/grafana"
      ]
    },
    "nginx": {
      "name": "nginx",
      "image": "nginx:latest",
      "container_name": "nginx",
      "context": ".",
      "dockerfile": "./frontend/Dockerfile",
      "domains": [
        "localhost"
      ],
      "ports": [
        "80:80",
        "443:443"
      ],
      "volumes": {
        "./nginx/logs": "/usr/share/nginx/logs",
        "./certs": "/etc/letsencrypt",
        "./nginx/html/.well-known/acme-challenge": "/usr/share/nginx/html/.well-known/acme-challenge",
        "./certs/live/dhparam": "/etc/ssl/certs/dhparam"
      },
      "networks": [
        "qrgen"
      ],
      "depends_on": [
        "express_service"
      ],
      "restart": "on-failure"
    },
    "certbot": {
      "name": "certbot",
      "context": ".",
      "dockerfile": "./certbot/Dockerfile",
      "container_name": "certbot",
      "entrypoint": "/bin/sh",
      "command": "certonly --webroot --webroot-path=/usr/share/nginx/html --register-unsafely-without-email --agree-tos --no-eff-email --non-interactive --rsa-key-size 4096 --force-renewal --hsts --staple-ocsp --uir --staple-ocsp --overwrite-cert-dirs --domains qr-gen.net",
      "ports": [],
      "volumes": {
        "./certs/logs": "/var/log/letsencrypt",
        "./certs": "/etc/letsencrypt",
        "./nginx/html/.well-known/acme-challenge": "/usr/share/nginx/html/.well-known/acme-challenge",
        "./certs/live/dhparam": "/etc/ssl/certs/dhparam"
      },
      "networks": [
        "qrgen"
      ],
      "depends_on": [
        "nginx"
      ],
      "restart": "no"
    }
  },
  "networks": {
    "qrgen": {
      "driver": "bridge"
    }
  },
  "volumes": {
    "shared": {
      "driver": "local"
    }
  },
  "environments": {
    "production": {
      "services": [
        "nginx",
        "express_service",
        "certbot"
      ],
      "overrides": {
        "nginx": {
          "domains": [
            "qr-gen.net"
          ]
        },
        "express_service": {
          "domains": [
            "qr-gen.net"
          ]
        },
        "certbot": {
          "command": "certonly --webroot --webroot-path=/usr/share/nginx/html --register-unsafely-without-email --agree-tos --no-eff-email --non-interactive --rsa-key-size 4096 --force-renewal --hsts --staple-ocsp --uir --staple-ocsp --overwrite-cert-dirs --domains qr-gen.net"
        }
      },
      "networks": {
        "qrgen": {
          "driver": "bridge"
        }
      },
      "volumes": {
        "shared": {
          "driver_opts": {
            "o": "addr=host.docker.internal,nolock,soft,rw,override_option"
          }
        }
      },
      "flags": {
        "auto_install_flag": true,
        "backend_scheme": "https",
        "build_certbot_image": true,
        "diffie_hellman_parameter_bit_size": 2048,
        "disable_docker_build_caching": true,
        "docker_compose_file": "docker-compose.yml",
        "email_flag": "--register-unsafely-without-email",
        "google_maps_api_key": "",
        "hsts_flag": "--hsts",
        "letsencrypt_email": "skip",
        "non_interactive_flag": "--non-interactive",
        "no_eff_email_flag": "--no-eff-email",
        "ocsp_stapling_flag": "--staple-ocsp",
        "origin": "void.qr-gen.net",
        "origin_port": "8080",
        "origin_url": "https://void.qr-gen.net",
        "productions_certs_flag": "--staging",
        "regenerate_diffie_hellman_parameters": true,
        "regenerate_ssl_certificates": true,
        "release_branch": "full-release",
        "rsa_key_size_flag": "--rsa-key-size 4096",
        "terms_of_service_flag": "--agree-tos",
        "use_auto_renew_ssl": true,
        "use_custom_domain": true,
        "use_dry_run": true,
        "use_force_renew": true,
        "use_google_api_key": true,
        "use_gzip_flag": true,
        "use_hsts": true,
        "use_letsencrypt": true,
        "use_must_staple": false,
        "use_ocsp_stapling": true,
        "use_overwrite_self_signed_certificates": true,
        "use_production_ssl": true,
        "use_ssl_flag": true,
        "use_strict_file_permissions": false,
        "use_tls_12_flag": false,
        "use_tls_13_flag": true,
        "use_uir": true,
        "domain": "qr-gen.net"
      }
    },
    "production-dry-run": {
      "services": [
        "nginx",
        "express_service",
        "certbot"
      ],
      "overrides": {
        "nginx": {
          "domains": [
            "qr-gen.net"
          ]
        },
        "express_service": {
          "domains": [
            "qr-gen.net"
          ]
        },
        "certbot": {
          "command": "certonly --webroot --webroot-path=/usr/share/nginx/html --register-unsafely-without-email --agree-tos --no-eff-email --non-interactive --rsa-key-size 4096 --force-renewal --hsts --staple-ocsp --uir --staple-ocsp --staging --dry-run --overwrite-cert-dirs --domains qr-gen.net"
        }
      },
      "networks": {
        "qrgen": {
          "driver": "bridge"
        }
      },
      "volumes": {
        "shared": {
          "driver_opts": {
            "o": "addr=host.docker.internal,nolock,soft,rw,override_option"
          }
        }
      },
      "flags": {
        "auto_install_flag": true,
        "backend_scheme": "https",
        "build_certbot_image": true,
        "diffie_hellman_parameter_bit_size": 2048,
        "disable_docker_build_caching": true,
        "docker_compose_file": "docker-compose.yml",
        "email_flag": "--register-unsafely-without-email",
        "google_maps_api_key": "",
        "hsts_flag": "--hsts",
        "letsencrypt_email": "skip",
        "non_interactive_flag": "--non-interactive",
        "no_eff_email_flag": "--no-eff-email",
        "ocsp_stapling_flag": "--staple-ocsp",
        "origin": "void.qr-gen.net",
        "origin_port": "8080",
        "origin_url": "https://void.qr-gen.net",
        "productions_certs_flag": "--staging",
        "regenerate_diffie_hellman_parameters": true,
        "regenerate_ssl_certificates": true,
        "release_branch": "full-release",
        "rsa_key_size_flag": "--rsa-key-size 4096",
        "terms_of_service_flag": "--agree-tos",
        "use_auto_renew_ssl": true,
        "use_custom_domain": true,
        "use_dry_run": true,
        "use_force_renew": true,
        "use_google_api_key": true,
        "use_gzip_flag": true,
        "use_hsts": true,
        "use_letsencrypt": true,
        "use_must_staple": false,
        "use_ocsp_stapling": true,
        "use_overwrite_self_signed_certificates": true,
        "use_production_ssl": true,
        "use_ssl_flag": true,
        "use_strict_file_permissions": false,
        "use_tls_12_flag": false,
        "use_tls_13_flag": true,
        "use_uir": true,
        "domain": "qr-gen.net"
      }
    },
    "staging": {
      "services": [
        "nginx",
        "express_service",
        "certbot"
      ],
      "overrides": {
        "nginx": {
          "domains": [
            "qr-gen.net"
          ]
        },
        "express_service": {
          "domains": [
            "qr-gen.net"
          ]
        },
        "certbot": {
          "command": "certonly --webroot --webroot-path=/usr/share/nginx/html --register-unsafely-without-email --agree-tos --no-eff-email --non-interactive --rsa-key-size 4096 --hsts --staple-ocsp --uir --staple-ocsp --staging --overwrite-cert-dirs --domains qr-gen.net"
        }
      },
      "networks": {
        "qrgen": {
          "driver": "bridge"
        }
      },
      "volumes": {
        "shared": {
          "driver_opts": {
            "o": "addr=host.docker.internal,nolock,soft,rw,override_option"
          }
        }
      },
      "flags": {
        "auto_install_flag": true,
        "backend_scheme": "https",
        "build_certbot_image": true,
        "diffie_hellman_parameter_bit_size": 2048,
        "disable_docker_build_caching": true,
        "docker_compose_file": "docker-compose.yml",
        "email_flag": "--register-unsafely-without-email",
        "google_maps_api_key": "",
        "hsts_flag": "--hsts",
        "letsencrypt_email": "skip",
        "non_interactive_flag": "--non-interactive",
        "no_eff_email_flag": "--no-eff-email",
        "ocsp_stapling_flag": "--staple-ocsp",
        "origin": "void.qr-gen.net",
        "origin_port": "8080",
        "origin_url": "https://void.qr-gen.net",
        "productions_certs_flag": "--staging",
        "regenerate_diffie_hellman_parameters": true,
        "regenerate_ssl_certificates": true,
        "release_branch": "full-release",
        "rsa_key_size_flag": "--rsa-key-size 4096",
        "terms_of_service_flag": "--agree-tos",
        "use_auto_renew_ssl": true,
        "use_custom_domain": true,
        "use_dry_run": true,
        "use_force_renew": true,
        "use_google_api_key": true,
        "use_gzip_flag": true,
        "use_hsts": true,
        "use_letsencrypt": true,
        "use_must_staple": false,
        "use_ocsp_stapling": true,
        "use_overwrite_self_signed_certificates": true,
        "use_production_ssl": true,
        "use_ssl_flag": true,
        "use_strict_file_permissions": false,
        "use_tls_12_flag": false,
        "use_tls_13_flag": true,
        "use_uir": true,
        "domain": "qr-gen.net"
      }
    },
    "self_signed": {
      "services": [
        "nginx",
        "express_service"
      ],
      "overrides": {
        "express_service": {
          "ports": [
            "3001:3001"
          ],
          "volumes": {
            "./certs/live/localhost": "/etc/ssl/certs/"
          }
        },
        "nginx": {
          "ports": [
            "443:443"
          ],
          "depends_on": [
            "express_service"
          ],
          "volumes": {
            "./nginx/logs": "/usr/share/nginx/logs",
            "./certs/live/localhost": "/etc/letsencrypt/live/localhost",
            "./certs/live/dhparam": "/etc/ssl/certs/dhparam"
          }
        }
      },
      "flags": {
        "auto_install_flag": true,
        "backend_scheme": "https",
        "diffie_hellman_parameter_bit_size": 2048,
        "disable_docker_build_caching": false,
        "google_maps_api_key": "",
        "regenerate_diffie_hellman_parameters": true,
        "regenerate_ssl_certificates": true,
        "release_branch": "full-release",
        "use_google_api_key": true,
        "use_gzip_flag": true,
        "use_hsts": true,
        "use_letsencrypt": false,
        "use_ocsp_stapling": true,
        "use_self_signed_certs": true,
        "use_ssl_flag": true,
        "use_tls_12_flag": false,
        "use_tls_13_flag": true,
        "domain": "localhost"
      }
    },
    "http": {
      "services": [
        "nginx",
        "express_service",
        "prometheus_init",
        "prometheus",
        "grafana"
      ],
      "overrides": {
        "express_service": {
          "ports": [
            "3001:3001"
          ]
        },
        "nginx": {
          "ports": [
            "80:80"
          ],
          "depends_on": [
            "express_service"
          ]
        }
      },
      "flags": {
        "build_certbot_image": false,
        "auto_install_flag": true,
        "backend_scheme": "http",
        "diffie_hellman_parameter_bit_size": 2048,
        "disable_docker_build_caching": true,
        "regenerate_diffie_hellman_parameters": false,
        "regenerate_ssl_certificates": false,
        "google_maps_api_key": "",
        "release_branch": "full-release",
        "use_custom_domain": false,
        "use_google_api_key": true,
        "use_gzip_flag": true,
        "use_hsts": false,
        "use_letsencrypt": false,
        "use_self_signed_certs": false,
        "use_ssl_flag": false,
        "use_tls_12_flag": false,
        "use_tls_13_flag": false,
        "domain": "localhost"
      }
    }
  }
}